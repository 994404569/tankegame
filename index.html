<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>贪吃蛇大作战</title>
<style>
    /* 1. 强制全屏，禁止滚动 */
    body {
        margin: 0;
        background-color: #2b2b2b;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        width: 100vw;
        overflow: hidden; /* 关键：防止手机下拉刷新 */
        touch-action: none; /* 关键：禁止浏览器默认触摸行为 */
        font-family: 'Arial', sans-serif;
        color: white;
    }

    /* 2. 游戏画面 */
    canvas {
        background-color: #000;
        border: 4px solid #555;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        display: block;
    }

    /* 3. 分数显示 */
    #score-board {
        font-size: 24px;
        margin-bottom: 15px;
        font-weight: bold;
        color: #4CAF50;
    }

    /* 4. 手机控制按钮区域 */
    #controls {
        margin-top: 20px;
        display: grid;
        grid-template-columns: 80px 80px 80px;
        grid-template-rows: 70px 70px;
        gap: 10px;
    }

    .btn {
        width: 80px;
        height: 70px;
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid #666;
        border-radius: 15px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 30px;
        user-select: none; /* 禁止文字被选中 */
        color: #ddd;
    }

    .btn:active {
        background-color: rgba(76, 175, 80, 0.5); /* 按下变绿 */
        transform: scale(0.95);
    }

    /* 布局占位符 */
    .spacer { pointer-events: none; }

</style>
</head>
<body>

    <div id="score-board">得分: <span id="score">0</span></div>
    
    <canvas id="gc" width="300" height="300"></canvas>

    <div id="controls">
        <div class="spacer"></div>
        <div class="btn" ontouchstart="keyPush(38)" onmousedown="keyPush(38)">▲</div>
        <div class="spacer"></div>
        
        <div class="btn" ontouchstart="keyPush(37)" onmousedown="keyPush(37)">◀</div>
        <div class="btn" ontouchstart="keyPush(40)" onmousedown="keyPush(40)">▼</div>
        <div class="btn" ontouchstart="keyPush(39)" onmousedown="keyPush(39)">▶</div>
    </div>

<script>
    // === 游戏核心逻辑 (原生 JS) ===
    const canvas = document.getElementById("gc");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");

    // 变量定义
    let px = 10, py = 10; // 蛇头坐标
    let gs = 15;          // 格子大小 (Grid Size)
    let tc = 20;          // 格子数量 (Tile Count: 300 / 15 = 20)
    let ax = 15, ay = 15; // 苹果坐标
    let xv = 0, yv = 0;   // 移动速度 X, Y
    let trail = [];       // 蛇身数组
    let tail = 5;         // 蛇身长度
    let score = 0;

    // 启动游戏循环
    window.onload = function() {
        // 键盘监听 (电脑版)
        document.addEventListener("keydown", function(evt) {
            keyPush(evt.keyCode);
        });
        // 每秒刷新 15 次
        setInterval(game, 1000/15);
    }

    // 游戏主循环
    function game() {
        px += xv;
        py += yv;

        // 穿墙逻辑 (从左边出去，从右边回来)
        if(px < 0) px = tc-1;
        if(px > tc-1) px = 0;
        if(py < 0) py = tc-1;
        if(py > tc-1) py = 0;

        // 1. 画背景 (黑色)
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 2. 画蛇 (绿色)
        ctx.fillStyle = "lime";
        for(let i = 0; i < trail.length; i++) {
            ctx.fillRect(trail[i].x * gs, trail[i].y * gs, gs - 2, gs - 2);
            
            // 撞到自己？
            if(trail[i].x == px && trail[i].y == py) {
                if(tail > 5) { // 只有蛇身变长后撞自己才重置
                    tail = 5;
                    score = 0;
                    scoreEl.innerText = score;
                    xv = 0; yv = 0; // 撞死后停下
                }
            }
        }

        // 更新蛇的位置记录
        trail.push({x: px, y: py});
        while(trail.length > tail) {
            trail.shift(); // 移除尾巴
        }

        // 3. 吃苹果逻辑
        if(ax == px && ay == py) {
            tail++; // 变长
            score += 10;
            scoreEl.innerText = score;
            // 随机生成新苹果位置
            ax = Math.floor(Math.random() * tc);
            ay = Math.floor(Math.random() * tc);
        }

        // 4. 画苹果 (红色)
        ctx.fillStyle = "red";
        ctx.fillRect(ax * gs, ay * gs, gs - 2, gs - 2);
    }

    // 控制逻辑
    function keyPush(code) {
        switch(code) {
            case 37: // 左
                if(xv != 1) { xv = -1; yv = 0; }
                break;
            case 38: // 上
                if(yv != 1) { xv = 0; yv = -1; }
                break;
            case 39: // 右
                if(xv != -1) { xv = 1; yv = 0; }
                break;
            case 40: // 下
                if(yv != -1) { xv = 0; yv = 1; }
                break;
        }
    }

    // 防止触摸时双击缩放
    document.addEventListener('dblclick', function(event) {
        event.preventDefault();
    }, { passive: false });

</script>
</body>
</html>
